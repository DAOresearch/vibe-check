---
title: API Reference
description: Complete TypeScript reference for Vibe Check
---


This section provides complete API documentation with TypeScript type signatures, parameters, return values, and examples.

---

## Core API

### [vibeTest](/api/vibetest/)
Evaluation-first test function for benchmarking and quality gates.

```typescript
vibeTest(
  name: string,
  fn: (ctx: VibeTestContext) => `Promise<void>` | void,
  timeoutOrOpts?: number | { timeout?: number }
): void
```

**Use cases:** Benchmarking models, quality gates, matrix testing

**Context provides:**
- `runAgent` - Execute agents
- `judge` - LLM-based evaluation
- `expect` - Custom matchers with Vitest assertions
- `annotate` - Stream progress to reporters
- `task` - Access Vitest task metadata

---

### [vibeWorkflow](/api/vibeworkflow/)
Automation-first workflow function for multi-stage pipelines.

```typescript
vibeWorkflow(
  name: string,
  fn: (ctx: WorkflowContext) => `Promise<void>`,
  options?: {
    timeout?: number;
    defaults?: { workspace?: string; model?: string }
  }
): void
```

**Use cases:** Multi-stage pipelines, loops/retries, production automation

**Context provides:**
- `stage(name, opts)` - Execute workflow stages
- `files` - Cumulative file changes across stages
- `tools` - Cumulative tool calls across stages
- `timeline` - Unified event timeline
- `until(predicate, body)` - Loop helper

---

### [prompt](/api/prompt/)
Create reusable, streamable prompts.

```typescript
function prompt(text: string): AsyncIterablePrompt
function prompt(options: {
  text: string;
  command?: string;
  attachments?: string[];
}): AsyncIterablePrompt
```

**Returns:** Async iterable compatible with Claude's streaming API

---

### [defineAgent](/api/defineagent/)
Configure agent execution environment.

```typescript
function defineAgent(spec: AgentSpec): Agent

interface AgentSpec {
  name?: string;
  model?: string;
  tools?: string[];
  mcpServers?: Record<string, MCPServerConfig>;
  source?: SourceSpec;
  timeouts?: { maxTurns?: number; timeoutMs?: number };
  systemPrompt?: SystemPromptSpec;
  commands?: Record<string, CommandDefinition>;
}
```

---

### [runAgent](/api/runagent/)
Execute an agent and get auto-captured execution context.

```typescript
async function runAgent(options: RunAgentOptions): Promise<RunResult>

interface RunAgentOptions {
  agent?: Agent;
  prompt: string | AsyncIterablePrompt;
  override?: Partial<AgentSpec>;
  workspace?: string;
  context?: RunResult;
}
```

**Returns `RunResult` with:**
- `metrics` - Tokens, cost (USD), duration, counts
- `messages` - Conversation messages (summarized, lazy-loaded)
- `todos` - Todo list with status tracking
- `git` - Git state before/after (if workspace provided)
- `files` - Changed files with lazy content loading
- `tools` - Tool calls with inputs/outputs/timing
- `timeline` - Unified event timeline (SDK + hooks)

**See:** [RunResult type definition](./types.md#runresult)

---

### [judge](/api/judge/)
LLM-based evaluation with rubrics.

```typescript
async function judge(
  result: RunResult,
  options: {
    rubric: Rubric;
    throwOnFail?: boolean;
  }
): Promise<JudgeResult>

interface JudgeResult {
  passed: boolean;
  score?: number;
  details?: Record<string, CriterionResult>;
}
```

---

## Matchers

### [Custom Matchers](/api/matchers/)
Quality assertions for agent results.

**File matchers:**
- `toHaveChangedFiles(paths: string[])` - Assert specific files changed (supports globs)
- `toHaveNoDeletedFiles()` - Assert no files were deleted

**Tool matchers:**
- `toHaveUsedTool(name, opts?)` - Assert tool usage with optional min/max counts
- `toUseOnlyTools(allowlist: string[])` - Assert only specified tools used

**Quality matchers:**
- `toCompleteAllTodos()` - Assert all todos completed
- `toHaveNoErrorsInLogs()` - Assert no error messages in logs
- `toPassRubric(rubric: Rubric)` - Assert LLM-based quality evaluation

**Cost matchers:**
- `toStayUnderCost(maxUsd: number)` - Assert cost under budget

---

## Types

### [TypeScript Types](/api/types/)
Complete type reference for all interfaces, types, and enums.

**Core types:**
- `RunResult` - Agent execution results with auto-captured context
- `FileChange` - Changed file with lazy content loading
- `ToolCall` - Tool invocation with inputs/outputs/timing
- `TimelineEvent` - Unified timeline events (SDK + hooks)

**Context types:**
- `VibeTestContext` - Test context for vibeTest
- `WorkflowContext` - Workflow context for vibeWorkflow

**Agent types:**
- `Agent` - Configured agent
- `AgentSpec` - Agent configuration specification
- `RunAgentOptions` - Options for runAgent

**Evaluation types:**
- `Rubric` - Evaluation criteria
- `JudgeResult` - Judge evaluation result

**Other types:**
- `SourceSpec` - Project source configuration
- `TodoItem` - Todo list item
- `AsyncIterablePrompt` - Streamable prompt

---

## Matrix Testing

### [defineTestSuite](/guides/evaluation/matrix-testing/)
Generate test combinations from arrays.

```typescript
defineTestSuite({
  name?: string;
  matrix: Record<string, any[]>;
  test: (combination: Record<string, any>) => void;
}): void
```

**Example:**
```typescript
defineTestSuite({
  matrix: {
    model: ['haiku', 'sonnet', 'opus'],
    maxTurns: [5, 10],
  },
  test: ({ model, maxTurns }) => {
    vibeTest(`${model} in ${maxTurns} turns`, async ({ runAgent }) => {
      // Test implementation
    });
  },
});
```

Generates **6 tests** (3 models × 2 turn limits)

---

## Configuration

### [defineVibeConfig](./types.md#definevibeconfig)
Configure Vitest with Vibe Check reporters and settings.

```typescript
function defineVibeConfig(config?: UserConfig): UserConfig
```

Adds:
- Vibe Check reporters (cost + HTML)
- TypeScript setup
- Sensible test timeouts

---

## Related Documentation

- **[Guides](/guides/)** - How to use the API in practice
- **[Recipes](/recipes/)** - Working code examples
- **[Examples](/examples/)** - Real-world usage

---

[← Back to Documentation Home](../)
